package com.xmltocfdi_3_3;

public class Test {

	static public void main(String args[]) throws Exception {
		System.out.println("123...");
	}
	
	static public void createPDF() throws Exception {
		String jasperPath = "/Users/javier/Proyectos/Workana/XmlToCFDI/xmltocfdi/src/main/resources/cfdi_v3_3.jasper";
		
		//Prefiero usar el .jrxml a la aplicacion que el .jasper por que es mas facil de versionar
		String sourceFileName = jasperPath;   
		
		
		File theFile = new File(sourceFileName);
		JasperDesign jasperDesign = JRXmlLoader.load(theFile);//Se carga el archivo

		//Si el reporte va a tener un query fijo, puedes omitir este paso
		JRDesignQuery newQuery = new JRDesignQuery();
		newQuery.setText("SELECT * FROM miTabla WHERE X = Y");
		jasperDesign.setQuery(newQuery);

		Map parameters = new HashMap();//Parametros que usa el jasperreports
		//Este parametro sirve para meter una funcion que el reporte va a ejecutar para encontrar la ruta fisica de sus imagenes
		parameters.put("REPORT_FILE_RESOLVER", new FileResolver() {
		                public File resolveFile(String fileName) {
		                    return new File(getServletContext().getRealPath("") + "\\mis_imagenes\\"+fileName); 
		                }
		            });
		//Se compila el archivo a .jasper
		JasperReport jasperReport = JasperCompileManager.compileReport(jasperDesign);

		//Aqui se llena el reporte (se ejecuta la consulta)
		JasperPrint print = new JasperPrint();
		print = JasperFillManager.fillReport(jasperReport, parameters, getConnection());
		byte[] pdfBytes = JasperExportManager.exportReportToPdf(print);
	}
	
}
